syntax = "proto3";

package api;

option go_package = "github.com/SplitStackServer/splitstack-grpc-api/go/api";
option java_package = "io.splitstack.api";
option java_multiple_files = true;
option java_outer_classname = "DeviceKeyProto";
option csharp_namespace = "SplitStackServer.Api";
option php_namespace = "SplitStackServer\\Api";
option php_metadata_namespace = "GPBMetadata\\SplitStackServer\\Api";


import "google/api/annotations.proto";
import "google/protobuf/timestamp.proto";

// DeviceService is the service providing API methods for managing devices.
service DeviceKeyService {
  
  // Create the given device-keys.
  rpc CreateDeviceKey(CreateDeviceKeyRequest) returns (CreateDeviceKeyResponse) {
    option (google.api.http) = {
      post : "/api/device-keys/key"
      body : "*"
    };
  }

  // Get the device-keys for the given DevEUI.
  rpc GetDeviceKey(GetDeviceKeyRequest) returns (GetDeviceKeyResponse) {
    option (google.api.http) = {
      get : "/api/device-keys/key/{eui}"
    };
  }

  // Update the given device-keys.
  rpc UpdateDeviceKey(UpdateDeviceKeyRequest) returns (UpdateDeviceKeyResponse) {
    option (google.api.http) = {
      put : "/api/device-keys/key/{eui}"
      body : "*"
    };
  }

}

message DeviceKey {
  // Device EUI (EUI64).
  string eui = 1;

  // Network Key (AES128).
  string network_key = 2;

  // Short ID must be set for preattached devices.
  //
  // Optional for OTAA devices as it can also be set during attachment.
  // 
  // This ID is used to identify the device in the network.
  optional string short_id = 3;

  // Device is preattached and does not perform OTAA.
  bool preattached = 4;
}

message CreateDeviceKeyRequest {
  // Device EUI (EUI64).
  string eui = 1;

  // Network Key (AES128).
  string network_key = 2;

  // Short ID must be set for preattached devices.
  //
  // Optional for OTAA devices as it can also be set during attachment.
  // 
  // This ID is used to identify the device in the network.
  optional string short_id = 3;

  // Device is preattached and does not perform OTAA.
  bool preattached = 4;
}

message CreateDeviceKeyResponse {
  // Device key object.
  DeviceKey device_key = 1;

  // Created at timestamp.
  google.protobuf.Timestamp created_at = 2;
}

message GetDeviceKeyRequest {
  // Device EUI (EUI64).
  string eui = 1;
}

message GetDeviceKeyResponse {
  // Device key object.
  DeviceKey device_key = 1;

  // Created at timestamp.
  google.protobuf.Timestamp created_at = 2;
}



message UpdateDeviceKeyRequest {
  // Device EUI (EUI64). 
  string eui = 1;

  // Network Key (AES128).
  optional string network_key = 2;

  // Short ID must be set for preattached devices.
  //
  // Optional for OTAA devices as it can also be set during attachment.
  // 
  // This ID is used to identify the device in the network.
  optional string short_id = 3;
}



message UpdateDeviceKeyResponse {
  // Device key object.
  DeviceKey device_key = 1;

	// Created at timestamp.
	google.protobuf.Timestamp created_at = 2;

	// Last update timestamp.
	google.protobuf.Timestamp updated_at = 3;
}
