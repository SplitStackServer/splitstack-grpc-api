syntax = "proto3";

package api;

option go_package = "github.com/SplitStackServer/splitstack-grpc-api/go/api";
option java_package = "io.splitstack.api";
option java_multiple_files = true;
option java_outer_classname = "DeviceProfileProto";
option csharp_namespace = "SplitStackServer.Api";
option php_namespace = "SplitStackServer\\Api";
option php_metadata_namespace = "GPBMetadata\\SplitStackServer\\Api";


import "google/api/annotations.proto";
import "google/protobuf/timestamp.proto";
import "google/protobuf/empty.proto";

import "common/common.proto";
import "api/common.proto";



// DeviceProfileService is the service providing API methods for managing
// device-profiles.
service DeviceProfileService {
  // Create the given device-profile.
  rpc CreateDeviceProfile(CreateDeviceProfileRequest) returns (CreateDeviceProfileResponse) {
    option (google.api.http) = {
      post : "/api/device-profiles"
      body : "*"
    };
  }

  // Get the device-profile for the given ID.
  rpc GetDeviceProfile(GetDeviceProfileRequest) returns (GetDeviceProfileResponse) {
    option (google.api.http) = {
      get : "/api/device-profiles/{id}"
    };
  }

  // Update the given device-profile.
  rpc UpdateDeviceProfile(UpdateDeviceProfileRequest) returns (UpdateDeviceProfileResponse) {
    option (google.api.http) = {
      put : "/api/device-profiles/{id}"
      body : "*"
    };
  }

  // Delete the device-profile with the given ID.
  rpc DeleteDeviceProfile(DeleteDeviceProfileRequest) returns (google.protobuf.Empty) {
    option (google.api.http) = {
      delete : "/api/device-profiles/{id}"
    };
  }

  // List the available device-profiles.
  rpc ListDeviceProfiles(ListDeviceProfilesRequest) returns (ListDeviceProfilesResponse) {
    option (google.api.http) = {
      get : "/api/device-profiles"
    };
  }
}

message DeviceProfile {
  // Device-profile ID (UUID).
  // Note: on create this will be automatically generated.
  string id = 1;

  // Tenant ID (UUID).
  string tenant_id = 2;

  // Name.
  string name = 3;

  // Description.
  optional string description = 4;

  // Manufacturer.
  string manufacturer = 5;

  // Firmware version.
  string firmware = 6;

  // Region.
  common.Region region = 7;

  // Device class.
  common.DeviceClass device_class = 8;

  // Uplink interval (seconds).
  // This defines the expected uplink interval which the device uses for
  // communication. If the uplink interval has expired and no uplink has
  // been received, the device is considered inactive.
  uint32 uplink_interval = 10;

  // Payload codec runtime.
  CodecRuntime payload_codec_runtime = 11;

  // Payload codec script.
  optional string payload_codec_script = 12;

  // Measurements.
  // If defined, ChirpStack will visualize these metrics in the web-interface.
  optional Measurements measurements = 20;

  // Auto-detect measurements.
  // If set to true, measurements will be automatically added based on the
  // keys of the decoded payload. In cases where the decoded payload contains
  // random keys in the data, you want to set this to false.
  bool auto_detect_measurements = 21;

  // Tags (user defined).
  // These tags can be used to add additional information the the
  // device-profile. These tags are exposed in all the integration events of
  // devices using this device-profile.
  optional common.Tags tags = 26;
}

enum CodecRuntime {
  // None.
  NONE = 0;

  // mioty BluePrint (JSON).
  BLUEPRINT = 1;

  // JavaScript.
  JS = 2;
}

enum MeasurementKind {
  // Unknown (in which case it is not tracked).
  UNKNOWN = 0;

  // Incrementing counters that never decrease (these are not reset on each
  // reading).
  COUNTER = 1;

  // Counters that do get reset upon reading.
  ABSOLUTE = 2;

  // E.g. a temperature value.
  GAUGE = 3;

  // E.g. a firmware version, true / false value.
  STRING = 4;
}

message Measurements {
  map<string, Measurement> measurements = 1;
}


message Measurement {
  // Name (user defined).
  string name = 2;

  // Kind.
  MeasurementKind kind = 3;
}


message DeviceProfileListItem {
  // Tenant ID.
  string tenant_id = 1;

  // Device-profile ID (UUID).
  string id = 2;

  // Created at timestamp.
  google.protobuf.Timestamp created_at = 3;

  // Last update timestamp.
  google.protobuf.Timestamp updated_at = 4;

  // Name.
  string name = 5;

  // Region.
  common.Region region = 6;

  // Device class.
  common.DeviceClass device_class = 7;

}

message CreateDeviceProfileRequest {
  // Tenant ID (UUID).
  string tenant_id = 1;

  // Name.
  string name = 2;

  // Description.
  optional string description = 3;

  // Manufacturer.
  string manufacturer = 4;

  // Firmware version.
  string firmware = 5;

  // Region.
  common.Region region = 6;

  // Device class.
  common.DeviceClass device_class = 7;

  // MAC Payload format (MPF)
  // Indicates that a telegram is a container for a MPF payload.
  optional common.MacPayloadFormat mac_format = 8;

  // Uplink interval (seconds).
  // This defines the expected uplink interval which the device uses for
  // communication. If the uplink interval has expired and no uplink has
  // been received, the device is considered inactive.
  uint32 uplink_interval = 9;

  // Payload codec runtime.
  CodecRuntime payload_codec_runtime = 10;

  // Payload codec script.
  optional string payload_codec_script = 11;

  // Measurements.
  // If defined, ChirpStack will visualize these metrics in the web-interface.
  optional Measurements measurements = 12;

  // Auto-detect measurements.
  // If set to true, measurements will be automatically added based on the
  // keys of the decoded payload. In cases where the decoded payload contains
  // random keys in the data, you want to set this to false.
  bool auto_detect_measurements = 13;

  // True if End Point uses dual channel mode
  bool dual_channel = 14;

  // True if End Point uses DL repetition
  bool repetition = 15;

  // True if End Point uses wide carrier offset
  bool wide_carr_off = 16;

  // True if End Point uses long DL interblock distance
  bool long_blk_dist = 17;

  // Tags (user defined).
  // These tags can be used to add additional information the the
  // device-profile. These tags are exposed in all the integration events of
  // devices using this device-profile.
  optional common.Tags tags = 18;
}

message CreateDeviceProfileResponse {
  // Device-profile object.
  DeviceProfile device_profile = 1;

  // Created at timestamp.
  google.protobuf.Timestamp created_at = 2;
}

message GetDeviceProfileRequest {
  // ID (UUID).
  string id = 1;
}

message GetDeviceProfileResponse {
  // Device-profile object.
  DeviceProfile device_profile = 1;

  // Created at timestamp.
  google.protobuf.Timestamp created_at = 2;

  // Last update timestamp.
  google.protobuf.Timestamp updated_at = 3;
}

message UpdateDeviceProfileRequest {
  // Device-profile ID (UUID).
  // Note: on create this will be automatically generated.
  string id = 1;

  // Name.
  optional string name = 3;

  // Description.
  optional string description = 4;

  // Manufacturer.
  optional string manufacturer = 5;

  // Firmware version.
  optional string firmware = 6;

  // Region.
  optional common.Region region = 7;

  // Device class.
  optional common.DeviceClass device_class = 8;

  // Uplink interval (seconds).
  // This defines the expected uplink interval which the device uses for
  // communication. If the uplink interval has expired and no uplink has
  // been received, the device is considered inactive.
  optional uint32 uplink_interval = 10;

  // Payload codec runtime.
  optional CodecRuntime payload_codec_runtime = 11;

  // Payload codec script.
  optional string payload_codec_script = 12;

  // Measurements.
  // If defined, ChirpStack will visualize these metrics in the web-interface.
  optional Measurements measurements = 13;

  // Auto-detect measurements.
  // If set to true, measurements will be automatically added based on the
  // keys of the decoded payload. In cases where the decoded payload contains
  // random keys in the data, you want to set this to false.
  optional bool auto_detect_measurements = 14;

  // Tags (user defined).
  // These tags can be used to add additional information the the
  // device-profile. These tags are exposed in all the integration events of
  // devices using this device-profile.
  optional common.Tags tags = 19;
}


message UpdateDeviceProfileResponse {
  // Device-profile object.
  DeviceProfile device_profile = 1;

  // Created at timestamp.
  google.protobuf.Timestamp created_at = 2;

  // Last update timestamp.
  google.protobuf.Timestamp updated_at = 3;
}


message DeleteDeviceProfileRequest {
  // ID (UUID).
  string id = 1;
}

message ListDeviceProfilesRequest {
  // Tenant ID to list the device-profiles for.
  // To list all device-profiles as a global admin user, this field can be left blank.
  optional string tenant_id = 1;

  // Pagination. Defaults to 100 objects at page index 0.
  Paginator paginator = 2;

  // If set, the given string will be used to search on name (optional).
  optional string search_name = 3;
}

message ListDeviceProfilesResponse {
  // Pagination.
  Pagination pagination = 1;

  // Result-set.
  repeated DeviceProfileListItem result = 2;
}


